{"version":3,"file":"cnd.js","sourceRoot":"","sources":["../src/cnd.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,kDAA6C;AAC7C,kDAAwB;AAExB,gFAE+B;AA6E/B;;GAEG;AACH,MAAa,GAAG;IAGd,YAAmB,MAAc;QAC/B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAEY,SAAS;;YACpB,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,OAAO,EAAE,CAAC;YAClC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;gBACZ,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;aACzC;YACD,OAAO,IAAI,CAAC,EAAE,CAAC;QACjB,CAAC;KAAA;IAEM,QAAQ,CAAC,IAAiB;QAC/B,OAAO,eAAK,CAAC,IAAI,CACf,IAAI,CAAC,OAAO,EAAE;aACX,IAAI,CAAC,cAAc,CAAC;aACpB,QAAQ,EAAE,EACb,IAAI,CACL,CAAC;IACJ,CAAC;IAEY,QAAQ;;YACnB,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAC9B,IAAI,CAAC,OAAO,EAAE;iBACX,IAAI,CAAC,OAAO,CAAC;iBACb,QAAQ,EAAE,CACd,CAAC;YACF,MAAM,MAAM,GAAG,QAAQ,CAAC,IAAc,CAAC;YACvC,OAAO,MAAM,CAAC,QAA6C,CAAC;QAC9D,CAAC;KAAA;IAEY,aAAa,CACxB,MAAc,EACd,QAA+B;;YAE/B,MAAM,OAAO,GAAG,MAAM,6BAAmB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;YAE5D,OAAO,eAAK,CAAC,OAAO,iBAClB,OAAO,EAAE,IAAI,CAAC,MAAM,IACjB,OAAO,EACV,CAAC;QACL,CAAC;KAAA;IAEY,OAAO,CAAC,EAAU;;YAC7B,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAC9B,IAAI,CAAC,OAAO,EAAE;iBACX,IAAI,CAAC,eAAe,CAAC;iBACrB,OAAO,CAAC,EAAE,CAAC;iBACX,QAAQ,EAAE,CACd,CAAC;YACF,OAAO,QAAQ,CAAC,IAAuC,CAAC;QAC1D,CAAC;KAAA;IAEO,OAAO;QACb,OAAO,IAAI,eAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC9B,CAAC;IAEa,OAAO;;YACnB,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;YAC5D,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;KAAA;CACF;AAhED,kBAgEC","sourcesContent":["import axios, { AxiosResponse } from \"axios\";\nimport URI from \"urijs\";\nimport { Action, EmbeddedRepresentationSubEntity, Entity } from \"../gen/siren\";\nimport actionToHttpRequest, {\n  FieldValueResolverFn\n} from \"./actionToHttpRequest\";\n\ninterface GetInfo {\n  id: string;\n  listen_addresses: string[]; // multiaddresses\n}\n\nexport interface Ledger {\n  name: string;\n  network: string;\n}\n\nexport interface Asset {\n  name: string;\n  quantity: string;\n}\n\nexport interface Peer {\n  peer_id: string;\n  address_hint: string;\n}\n\nexport interface SwapRequest {\n  alpha_ledger: Ledger;\n  alpha_asset: Asset;\n  beta_ledger: Ledger;\n  beta_asset: Asset;\n  alpha_expiry: number;\n  beta_expiry: number;\n  alpha_ledger_refund_identity?: string;\n  beta_ledger_redeem_identity?: string;\n  peer: Peer;\n}\n\nexport interface BitcoinSendAmountToAddressPayload {\n  to: string;\n  amount: string;\n  network: string;\n}\n\nexport interface BitcoinBroadcastSignedTransactionPayload {\n  hex: string;\n  network: string;\n}\n\nexport interface EthereumDeployContractPayload {\n  data: string;\n  amount: string;\n  gas_limit: string;\n  network: string;\n}\n\nexport interface EthereumCallContractPayload {\n  contract_address: string;\n  data: string;\n  gas_limit: string;\n  network: string;\n}\n\nexport type LedgerAction =\n  | {\n      type: \"bitcoin-send-amount-to-address\";\n      payload: BitcoinSendAmountToAddressPayload;\n    }\n  | {\n      type: \"bitcoin-broadcast-signed-transaction\";\n      payload: BitcoinBroadcastSignedTransactionPayload;\n    }\n  | {\n      type: \"ethereum-deploy-contract\";\n      payload: EthereumDeployContractPayload;\n    }\n  | {\n      type: \"ethereum-call-contract\";\n      payload: EthereumCallContractPayload;\n    };\n\n/**\n * Facilitates access to the cnd REST API\n */\nexport class Cnd {\n  private readonly cndUrl: string;\n\n  public constructor(cndUrl: string) {\n    this.cndUrl = cndUrl;\n  }\n\n  public async getPeerId(): Promise<string> {\n    const info = await this.getInfo();\n    if (!info.id) {\n      throw new Error(\"id field not present\");\n    }\n    return info.id;\n  }\n\n  public postSwap(swap: SwapRequest): Promise<string> {\n    return axios.post(\n      this.rootUrl()\n        .path(\"swaps/rfc003\")\n        .toString(),\n      swap\n    );\n  }\n\n  public async getSwaps(): Promise<EmbeddedRepresentationSubEntity[]> {\n    const response = await axios.get(\n      this.rootUrl()\n        .path(\"swaps\")\n        .toString()\n    );\n    const entity = response.data as Entity;\n    return entity.entities as EmbeddedRepresentationSubEntity[];\n  }\n\n  public async executeAction(\n    action: Action,\n    resolver?: FieldValueResolverFn\n  ): Promise<AxiosResponse> {\n    const request = await actionToHttpRequest(action, resolver);\n\n    return axios.request({\n      baseURL: this.cndUrl,\n      ...request\n    });\n  }\n\n  public async getSwap(id: string): Promise<EmbeddedRepresentationSubEntity> {\n    const response = await axios.get(\n      this.rootUrl()\n        .path(\"swaps/rfc003/\")\n        .segment(id)\n        .toString()\n    );\n    return response.data as EmbeddedRepresentationSubEntity;\n  }\n\n  private rootUrl() {\n    return new URI(this.cndUrl);\n  }\n\n  private async getInfo(): Promise<GetInfo> {\n    const response = await axios.get(this.rootUrl().toString());\n    return response.data;\n  }\n}\n"]}